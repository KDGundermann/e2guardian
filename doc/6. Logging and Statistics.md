# 6. Logging and Statistics

Beside the normal messages generated by the program the most interesting part of e2guardian is logging of the client accesses, 
e.g. logging who accessed which site, with lots of additional information (status code, size in bytes, virus checked.)

## 6.1 Program messages

E2guardian send its info messages, warning and error messages to the standard linux syslog destination using 'e2guardian' as tag.

If you prefer to send these messages to stdout/stderr (specially when e2guardian is running in forground for debugging purposes)
you may change the configuration options in the main config file e2guardian.conf:

  set_error = 'stderr'
  set_info = 'stdout'
  set_warning = 'stderr'

The default configuration is using:

  set_error = 'syslog:LOG_ERR'
  set_info = 'syslog:LOG_INFO'
  set_warning = 'syslog:LOG_WARNING'

( Read more how to configure the logger in section 7. Advanced Configuration )  

### 6.1.1 Docker mode

When running e2guardian in a docker container (see Section 2.x) you may use the configuration option:

    dockermode = on

We will then send all program messages to stderr (as stderr is not buffered by docker)
and the access log to stdout. (so you may use 'docker logs -f' or other docker management tools
to see the output of e2guardian)

## 6.2 Access Logger

When a client request to visit a website the server will respond and send the requested data.
E2guardian will collect some infomation on this request/responses and generate a log entry.

These AccessLog entries will by default go to '/var/log/e2guardian/access.log', 
there is a configuration option in e2guardian.conf:

  set_accesslog = 'file:/var/log/e2guardian/access.log'

You may send it to another destination or to syslog (or in case of docker mode turned on to stdout)

We have some predefined log formats with specific columns and delimiters, e.g.:

    1 = Dansguardian format (space delimited)
    2 = CSV-style format
    3 = Squid Log File Format
    4 = Tab delimited
    5 = Protex format

but you may define your own logging format whith your choice of columns and delimiters (NEW in v.5.5)

To decrease the amount of logged data you may filter WHAT should be logged:

    loglevel = 3
    # 0 = none  1 = just denied  2 = all text based  3 = all requests

    logexceptionhits = 2
    # Log if an exception (user, ip, URL, phrase) is matched and so
    # the page gets let through.  Can be useful for diagnosing  why a site gets through the filter.

    logadblocks = off
    # Enable logging of "ADs" category blocks

### 6.2.1 Custom log formats

You may choose to define your own log format by setting the following configuration option in e2guardian.conf:

    logformat = "time clientname hostname url statuscode bytes"
    logdelimiter = "\t"

You may choose from the following columns:

    - time : time of the request in humanreadably format
    - timestamp: time as UNIX timestamp
    - timeutc: time in UTC format
    - clientname: DNS Name of the client
    - clientip: IP Adress of client
    - hostname:
    - hostip:
    - method: HTTP method used: GET or POST or CONNECT
    - proto: the protocol used: HTTP or HTTPS
    - url:
    - path:
    - port:
    - params:
    - statuscode: HTTP status code e.g. 200
    - status: HTTP status e.g. OK
    - bytes: response size in bytes
    - ...

## 6.3 Programm statistics

E2guardian collects some statistics abouts its usage, e.g. the number of connections per seconds.
The default values for dstat are:

    dstatlocation = '/var/log/e2guardian/dstats.log'
    dstatinterval = 300  # = 5 minutes

The following data is collected:

- httpw : number of HTTP workers
- busy:  number of currently busy workers
- httpwQ: number of requests waiting in the queue for a worker
- logQ: number of log entries waiting in the queue
- conx + conx/s: number of client connections in stat interval and per second
- reqs + reqs/s: number of client requests in stat interval and per second
- maxfd: maximum a parallel connections used in stat interval
- LCcnt: number of LOptionContainers
